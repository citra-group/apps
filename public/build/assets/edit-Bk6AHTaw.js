import{_ as A,b as U,w as a,e,i as m,B as N,V as y,g as s,E as h,l as p,m as _,p as o,$ as D,I as g,C as T,d as w,H as P,h as B,j as c,k as E,F as R,R as S,P as F,W as z,Q as q,D as H,o as x,t as b,n as k,Y as J}from"./App-DxUS_QIK.js";import{V as j,a as L}from"./VExpansionPanels-D1_vKqWV.js";const O={name:"reservation-product-edit",data(){return{expand:!1,images:[],dialogImage:!1,selectedImageIndex:null,newImages:[],productExpand:!1,isedit:!1,editIndex:null,activeRecord:null,items:[],detail:{},formatter:new Intl.NumberFormat("id-ID",{currency:"IDR",minimumFractionDigits:0})}},methods:{detailCalculate(n,l){l.total=parseInt(l.qty)*parseFloat(l.price)},calculateTotal(n,l){if(!Array.isArray(l.details))return;const r=l.details.reduce((u,f)=>{const I=parseFloat(f.total||0);return u+(isNaN(I)?0:I)},0);l.basic=r;const V=parseFloat(l.discount||0);l.discount_total=r*(isNaN(V)?0:V)/100;const i=parseFloat(l.fee||0);l.fee_total=r*(isNaN(i)?0:i)/100,l.price=r+l.discount_total+l.fee_total,l.total=l.discount_total+l.fee_total},openExpand(n){this.detail=JSON.parse(JSON.stringify(n.detailmap||[])),this.productExpand=!0,this.isedit=!1},saveDetailProduct(n){Array.isArray(n.details)||(n.details=[]),this.editIndex!==null?(n.details.splice(this.editIndex,1,{...this.detail}),this.editIndex=null):n.details.push({...this.detail}),this.calculateTotal(this.detail,n),this.detail={},this.productExpand=!1},cancelDetailProduct(){this.productExpand=!1,this.detail={}},detailEdit(n,l,r){this.detail={...n},this.editIndex=l,this.productExpand=!0,this.isedit=!0,this.activeRecord=r},detailRemove(n,l){l.details.splice(n,1),this.calculateTotal(this.detail,l)},toggleImage(n){this.images=Array.isArray(n.images)?[...n.images]:[],this.expand=!0},handleImageUpload(n){n&&Array.from(n).forEach(l=>{const r=new FileReader;r.onload=V=>{this.images.push(V.target.result)},r.readAsDataURL(l)})},saveImage(n){n.images=[...this.images],this.expand=!1,this.newImages=[]},removeImage(){this.selectedImageIndex!==null&&(this.images.splice(this.selectedImageIndex,1),this.dialogImage=!1,this.selectedImageIndex=null),this.newImages=[]},openDeleteDialog(n){this.selectedImageIndex=n,this.dialogImage=!0}}},Q={class:"text-end"},Y={style:{"text-align":"right"}},G={class:"text-end"};function W(n,l,r,V,i,u){const f=w("v-currency-field"),I=w("form-edit");return x(),U(I,{"with-helpdesk":"","max-width":"700"},{default:a(({record:d})=>[e(p,null,{default:a(()=>[e(y,{dense:""},{default:a(()=>[e(s,{cols:"12"},{default:a(()=>[e(h,{label:"Name",onInput:t=>d.name=d.name.toUpperCase(),modelValue:d.name,"onUpdate:modelValue":t=>d.name=t},null,8,["onInput","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),m("div",Q,[e(p,{class:"p-0"},{default:a(()=>[e(_,{size:"small",onClick:t=>u.openExpand(d)},{default:a(()=>l[9]||(l[9]=[o("+EddNew")])),_:2,__:[9]},1032,["onClick"])]),_:2},1024)]),e(g,{class:"my-4"},{default:a(()=>[e(D,{class:"text-uppercase"},{default:a(()=>l[10]||(l[10]=[o("Details Product")])),_:1,__:[10]})]),_:1}),N(e(P,{flat:""},{default:a(()=>[e(p,null,{default:a(()=>[e(y,{density:"compack"},{default:a(()=>[e(s,{cols:"4"},{default:a(()=>[e(h,{label:"Nama",modelValue:i.detail.name,"onUpdate:modelValue":l[0]||(l[0]=t=>i.detail.name=t),variant:"underlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(s,{cols:"2"},{default:a(()=>[e(f,{label:"Jumlah",modelValue:i.detail.qty,"onUpdate:modelValue":l[1]||(l[1]=t=>i.detail.qty=t),variant:"underlined","model-value":Number(i.detail.qty),"hide-details":""},null,8,["modelValue","model-value"])]),_:1}),e(s,{cols:"3"},{default:a(()=>[e(f,{label:"Harga",prefix:"Rp",modelValue:i.detail.price,"onUpdate:modelValue":l[2]||(l[2]=t=>i.detail.price=t),"model-value":Number(i.detail.price),onInput:l[3]||(l[3]=t=>u.detailCalculate(t,i.detail)),variant:"underlined","hide-details":""},null,8,["modelValue","model-value"])]),_:1}),e(s,{cols:"3"},{default:a(()=>[e(f,{label:"Total",prefix:"Rp",modelValue:i.detail.total,"onUpdate:modelValue":l[4]||(l[4]=t=>i.detail.total=t),"model-value":Number(i.detail.total),onInput:l[5]||(l[5]=t=>u.calculateTotal(t,i.detail)),variant:"underlined","hide-details":""},null,8,["modelValue","model-value"])]),_:1})]),_:1}),e(p,{class:"text-end mt-4"},{default:a(()=>[e(_,{class:"mr-2",color:"grey",size:"small",onClick:t=>u.cancelDetailProduct(d)},{default:a(()=>l[11]||(l[11]=[o("Batal")])),_:2,__:[11]},1032,["onClick"]),e(_,{color:"primary",size:"small",onClick:t=>u.saveDetailProduct(d)},{default:a(()=>l[12]||(l[12]=[o("Simpan")])),_:2,__:[12]},1032,["onClick"]),e(g,{class:"mt-4 mb-4"})]),_:2},1024)]),_:2},1024)]),_:2},1536),[[T,i.productExpand]]),e(p,null,{default:a(()=>[e(B,{flat:""},{default:a(()=>[l[15]||(l[15]=m("thead",null,[m("tr",null,[m("th",{class:"text-left"},"Name"),m("th",{class:"text-left"},"QTY"),m("th",{class:"text-left"},"Harga"),m("th",{class:"text-left"},"Total"),m("th",{class:"text-left"},"Aksi")])],-1)),m("tbody",null,[(x(!0),c(R,null,E(d.details,(t,v)=>(x(),c("tr",{key:t.index},[m("td",null,b(t.name),1),m("td",null,b(t.qty),1),m("td",null,b(i.formatter.format(t.price)),1),m("td",null,b(i.formatter.format(t.total)),1),m("td",Y,[e(_,{class:"mr-2",color:"green",icon:"",dark:"",variant:"tonal",size:"small",onClick:C=>u.detailEdit(t,v,d)},{default:a(()=>[e(k,null,{default:a(()=>l[13]||(l[13]=[o(" edit ")])),_:1,__:[13]})]),_:2},1032,["onClick"]),e(_,{color:"deep-orange",icon:"",dark:"",variant:"tonal",size:"small",onClick:C=>u.detailRemove(v,d)},{default:a(()=>[e(k,null,{default:a(()=>l[14]||(l[14]=[o(" delete ")])),_:1,__:[14]})]),_:2},1032,["onClick"])])]))),128))])]),_:2,__:[15]},1024),e(g)]),_:2},1024),e(p,null,{default:a(()=>[e(y,{dense:""},{default:a(()=>[e(s,{cols:"8"},{default:a(()=>l[16]||(l[16]=[o(" ")])),_:1,__:[16]}),e(s,{cols:"4"},{default:a(()=>[e(f,{density:"compact",label:"Price",prefix:"Rp",modelValue:d.price,"onUpdate:modelValue":t=>d.price=t,"model-value":Number(d.price),variant:"solo",flat:"",readonly:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue","model-value"])]),_:2},1024),e(s,{cols:"8"},{default:a(()=>l[17]||(l[17]=[o(" ")])),_:1,__:[17]}),e(s,{cols:"4"},{default:a(()=>[e(f,{density:"compact",label:"Harga Awal",prefix:"Rp",modelValue:d.basic,"onUpdate:modelValue":t=>d.basic=t,"model-value":Number(d.basic),variant:"solo",flat:"",readonly:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue","model-value"])]),_:2},1024),e(s,{cols:"8"}),e(s,{cols:"4"},{default:a(()=>[e(f,{density:"compact",label:"Diskon",suffix:"/ %",modelValue:d.discount,"onUpdate:modelValue":t=>d.discount=t,"model-value":Number(d.discount),onInput:t=>u.calculateTotal(null,d),variant:"underlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","model-value","onInput"])]),_:2},1024),e(s,{cols:"8"},{default:a(()=>l[18]||(l[18]=[o(" ")])),_:1,__:[18]}),e(s,{cols:"4"},{default:a(()=>[e(f,{density:"compact",label:"Diskon Total",prefix:"Rp",modelValue:d.discount_total,"onUpdate:modelValue":t=>d.discount_total=t,"model-value":Number(d.discount_total),variant:"solo",flat:"",readonly:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue","model-value"])]),_:2},1024),e(s,{cols:"8"},{default:a(()=>l[19]||(l[19]=[o(" ")])),_:1,__:[19]}),e(s,{cols:"4"},{default:a(()=>[e(f,{density:"compact",label:"Fee",suffix:"/ %",modelValue:d.fee,"onUpdate:modelValue":t=>d.fee=t,"model-value":Number(d.fee),onInput:t=>u.calculateTotal(null,d),variant:"underlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","model-value","onInput"])]),_:2},1024),e(s,{cols:"8"},{default:a(()=>l[20]||(l[20]=[o(" ")])),_:1,__:[20]}),e(s,{cols:"4"},{default:a(()=>[e(f,{density:"compact",label:"Total Fee",prefix:"Rp",modelValue:d.fee_total,"onUpdate:modelValue":t=>d.fee_total=t,"model-value":Number(d.fee_total),variant:"solo",flat:"",readonly:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue","model-value"])]),_:2},1024),e(s,{cols:"8"},{default:a(()=>l[21]||(l[21]=[o(" ")])),_:1,__:[21]}),e(s,{cols:"4"},{default:a(()=>[e(f,{density:"compact",label:"Total",prefix:"Rp",modelValue:d.total,"onUpdate:modelValue":t=>d.total=t,"model-value":Number(d.total),variant:"solo",flat:"",readonly:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue","model-value"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(p,null,{default:a(()=>[m("div",G,[e(_,{flat:"",size:"small",color:"primary",class:"ma-2",onClick:t=>u.toggleImage(d),disabled:i.expand,"hide-details":""},{default:a(()=>l[22]||(l[22]=[o(" Tambah Foto ")])),_:2,__:[22]},1032,["onClick","disabled"])]),e(g,{class:"my-4"},{default:a(()=>[e(D,{class:"text-uppercase"},{default:a(()=>l[23]||(l[23]=[o("Details Image")])),_:1,__:[23]})]),_:1})]),_:2},1024),e(p,null,{default:a(()=>[N(e(j,{flat:""},{default:a(()=>[e(L,null,{default:a(()=>[e(p,null,{default:a(()=>[e(S,{variant:"underlined",modelValue:i.newImages,"onUpdate:modelValue":[l[6]||(l[6]=t=>i.newImages=t),u.handleImageUpload],accept:"image/*",label:"Pilih Gambar","prepend-icon":"add_a_photo",multiple:"","show-size":"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(F,null,{default:a(()=>[e(z),e(_,{color:"primary",onClick:t=>u.saveImage(d)},{default:a(()=>l[24]||(l[24]=[o(" Simpan ")])),_:2,__:[24]},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1536),[[T,i.expand]])]),_:2},1024),e(p,null,{default:a(()=>[e(y,null,{default:a(()=>[(x(!0),c(R,null,E(i.images,(t,v)=>(x(),U(s,{key:v,cols:"12",sm:"4",md:"3"},{default:a(()=>[e(J,{src:t,"aspect-ratio":"1",rounded:"lg",cover:""},null,8,["src"]),e(_,{small:"",icon:"",variant:"tonal",color:"red",class:"mt-1",onClick:C=>u.openDeleteDialog(v)},{default:a(()=>[e(k,null,{default:a(()=>l[25]||(l[25]=[o("delete")])),_:1,__:[25]})]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1}),e(q,{modelValue:i.dialogImage,"onUpdate:modelValue":l[8]||(l[8]=t=>i.dialogImage=t),transition:"dialog-bottom-transition",width:"auto"},{default:a(()=>[e(H,null,{default:a(()=>[e(p,null,{default:a(()=>l[26]||(l[26]=[o(" Apakah Anda yakin ingin menghapus gambar ini?")])),_:1,__:[26]}),e(g,{class:"mb-4"}),e(F,{class:"justify-end"},{default:a(()=>[e(_,{variant:"text",onClick:l[7]||(l[7]=t=>i.dialogImage=!1)},{default:a(()=>l[27]||(l[27]=[o("Batal")])),_:1,__:[27]}),e(_,{color:"red",variant:"text",onClick:u.removeImage},{default:a(()=>l[28]||(l[28]=[o("Delete")])),_:1,__:[28]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const X=A(O,[["render",W]]);export{X as default};
